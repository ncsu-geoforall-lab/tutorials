<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Veronica Andreo">

<title>Time series accumulations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">GRASS Tutorials</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ncsu-geoforall-lab/tutorials">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ncsu-geoforall-lab/tutorials/issues">
            Report an Issue
            </a>
          </li>
      </ul>
    </div>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#t.rast.accumulate" id="toc-t.rast.accumulate" class="nav-link active" data-scroll-target="#t.rast.accumulate">t.rast.accumulate</a>
  <ul class="collapse">
  <li><a href="#accumulation-using-bedd" id="toc-accumulation-using-bedd" class="nav-link" data-scroll-target="#accumulation-using-bedd">Accumulation using BEDD</a></li>
  <li><a href="#suitable-areas-for-mosquitos" id="toc-suitable-areas-for-mosquitos" class="nav-link" data-scroll-target="#suitable-areas-for-mosquitos">Suitable areas for mosquitos</a></li>
  </ul></li>
  <li><a href="#t.rast.accdetect" id="toc-t.rast.accdetect" class="nav-link" data-scroll-target="#t.rast.accdetect">t.rast.accdetect</a>
  <ul class="collapse">
  <li><a href="#detection-of-mosquito-generations" id="toc-detection-of-mosquito-generations" class="nav-link" data-scroll-target="#detection-of-mosquito-generations">Detection of mosquito generations</a></li>
  <li><a href="#maximum-number-of-generations-per-year" id="toc-maximum-number-of-generations-per-year" class="nav-link" data-scroll-target="#maximum-number-of-generations-per-year">Maximum number of generations per year</a></li>
  <li><a href="#median-duration-of-mosquito-generations-per-year" id="toc-median-duration-of-mosquito-generations-per-year" class="nav-link" data-scroll-target="#median-duration-of-mosquito-generations-per-year">Median duration of mosquito generations per year</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Time series accumulations</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">GRASS GIS</div>
    <div class="quarto-category">Time series</div>
    <div class="quarto-category">raster</div>
    <div class="quarto-category">Advanced</div>
    <div class="quarto-category">Python</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Veronica Andreo </p>
          </div>
  </div>
    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">August 29, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<p>In this fourth part of the time series tutorials, we will go through data accumulation. We’ll mostly follow a modified version of the example presented in the <a href="https://grass.osgeo.org/grass-stable/manuals/t.rast.accumulate.html">t.rast.accumulate</a> and <a href="https://grass.osgeo.org/grass-stable/manuals/t.rast.accdetect.html">t.rast.accdetect</a> tools.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Setup">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Setup
</div>
</div>
<div class="callout-body-container callout-body">
<p>This tutorial can be run locally or in Google Colab. However, make sure you install GRASS GIS 8.4+, download the LST sample data and set up your project as explained in the <a href="../time_series/time_series_management_and_visualization.html">first part</a> of these time series tutorials.</p>
</div>
</div>
<section id="t.rast.accumulate" class="level2">
<h2 class="anchored" data-anchor-id="t.rast.accumulate"><a href="https://grass.osgeo.org/grass-stable/manuals/t.rast.accumulate.html">t.rast.accumulate</a></h2>
<p><em>t.rast.accumulate</em> performs temporal accumulations of raster time series. Data accumulations are common in ecology or agriculture, especially temperature accumulation. Usually, to determine if insects or plants can survive in a certain place, a measure of accumulated temperature is used. For example, a certain plant species might need x GDD to bloom, or a mosquito species might need x GDD to complete their development from egg to adult. Therefore, it is usual to accumulate temperature data, but other variables can be accumulated too, e.g.&nbsp;chlorophyll concentration to determine algal bloom occurrences in water bodies.</p>
<p><em>t.rast.accumulate</em> expects a STRDS as input that will be sampled by a given granularity. All maps that have the start time during the actual granule will be accumulated with the predecessor granule accumulation result using the raster module r.series.accumulate. The default granularity is 1 day, but any temporal granularity can be set. The start time and the end time of the accumulation process must be set. In addition, a cycle can be specified that defines after which interval of time the accumulation process restarts. The offset option specifies the time that should be skipped between two cycles.</p>
<p>The lower and upper limits of the accumulation process can be set, either by using space time raster datasets or by using fixed values for all raster cells and time steps by means of the limits option is used, eg. limits=10,30. The upper limit is only used in the Biologically Effective Degree Days calculation.</p>
<p>The output is a new space time raster dataset with the provided start time, end time and granularity containing the accumulated raster maps.</p>
<section id="accumulation-using-bedd" class="level3">
<h3 class="anchored" data-anchor-id="accumulation-using-bedd">Accumulation using BEDD</h3>
<p>Let’s consider the mosquito <em>Aedes albopictus</em>. Adults require a minimum average temperature of 11 °C to survive. We will compute the Biologically Effective Degree Days (BEDD) from 2014 until 2018 for each year with a granularity of one day. The base temperature will be 11°C, and the upper limit 30°C where adult mosquito survival is known to decrease. Hence the accumulation will start at 11°C and stop at 30°C.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accumulation of degree days</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>gs.run_command(<span class="st">"t.rast.accumulate"</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>               <span class="bu">input</span><span class="op">=</span><span class="st">"lst_daily"</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>               output<span class="op">=</span><span class="st">"mosq_daily_bedd"</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>               basename<span class="op">=</span><span class="st">"mosq_daily_bedd"</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>               suffix<span class="op">=</span><span class="st">"gran"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>               start<span class="op">=</span><span class="st">"2014-01-01"</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>               stop<span class="op">=</span><span class="st">"2019-01-01"</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>               cycle<span class="op">=</span><span class="st">"12 months"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>               method<span class="op">=</span><span class="st">"bedd"</span>, </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>               limits<span class="op">=</span><span class="st">"11,30"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get basic info</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>gs.run_command(<span class="st">"t.info"</span>, <span class="bu">input</span><span class="op">=</span><span class="st">"mosq_daily_bedd"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="suitable-areas-for-mosquitos" class="level3">
<h3 class="anchored" data-anchor-id="suitable-areas-for-mosquitos">Suitable areas for mosquitos</h3>
<p>According to Kobashayi et al (2002), populations of <em>Aedes albopictus</em> establish where at least 1350 DD are accumulated. These DD should be reached before Oct 1st to consider a place as suitable. Let’s find out when and where that condition is met.</p>
<p>We will first discard all cells with BEDD &lt; 1350 from our accumulated time series, and then we will save the day of the year (DOY) where BEDD &gt;= 1350.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>exp<span class="op">=</span><span class="st">"doy_bedd_higher_1350 = if(mosq_daily_bedd &gt;= 1350, start_doy(mosq_daily_bedd, 0), null())"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>gs.run_command(<span class="st">"t.rast.algebra"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>               expression<span class="op">=</span>exp,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>               basename<span class="op">=</span><span class="st">"doy_bedd_higher_1350"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>               suffix<span class="op">=</span><span class="st">"gran"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>               nprocs<span class="op">=</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we aggregate the <code>doy_bedd_higher_1350</code> STRDS on an annual basis, as we want to see possible changes among years. We use <code>method=minimum</code> to get the earliest day on which the condition is met each year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>gs.run_command(<span class="st">"t.rast.aggregate"</span>,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>               <span class="bu">input</span><span class="op">=</span><span class="st">"doy_bedd_higher_1350"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>               method<span class="op">=</span><span class="st">"minimum"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>               granularity<span class="op">=</span><span class="st">"1 year"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>               output<span class="op">=</span><span class="st">"annual_doy_bedd_higher_1350"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>               basename<span class="op">=</span><span class="st">"annual_doy_bedd_higher_1350"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>               suffix<span class="op">=</span><span class="st">"gran"</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>               nprocs<span class="op">=</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>gs.run_command(<span class="st">"t.rast.list"</span>,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                <span class="bu">input</span><span class="op">=</span><span class="st">"annual_doy_bedd_higher_1350"</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                columns<span class="op">=</span><span class="st">"id,min,max"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Following Neteler et al (2013), if the 1350 DD are achieved on or before August 1st, a place is considered highly suitable for <em>Aedes albopictus</em>, while if the condition is met after October 1st, the place is not suitable. Everything in between is defined as a linear function of DOY. Once again, we use the temporal algebra to create yearly suitability maps. Note we are using a nested if statement.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>expression<span class="op">=</span><span class="st">"suitability = if(annual_doy_bedd_higher_1350 &lt;= 214, 1, if(annual_doy_bedd_higher_1350 &gt; 214 &amp;&amp; annual_doy_bedd_higher_1350 &lt;= 274, (274 - annual_doy_bedd_higher_1350)/60.0, if(annual_doy_bedd_higher_1350 &gt; 274, 0)))"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>gs.run_command(<span class="st">"t.rast.algebra"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>               expression<span class="op">=</span>expression,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>               basename<span class="op">=</span><span class="st">"suitability"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>               suffix<span class="op">=</span><span class="st">"gran"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>               nprocs<span class="op">=</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s see how suitable area and suitability values change with time by means of an animation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Animation of annual anomalies</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>suitability <span class="op">=</span> gj.TimeSeriesMap(use_region<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>suitability.add_raster_series(<span class="st">"suitability"</span>, fill_gaps<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>suitability.d_legend(color<span class="op">=</span><span class="st">"black"</span>, at<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">40</span>,<span class="dv">2</span>,<span class="dv">6</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>suitability.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Impressive, ah? Let’s do some basic math to quantify the suitable area increase from 2014 to 2018. We use <code>r.univar</code> to get the number of non-null cells in each map.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>land_cells <span class="op">=</span> gs.parse_command(<span class="st">"r.univar"</span>, <span class="bu">map</span><span class="op">=</span><span class="st">"lst_2014.001_avg"</span>, flags<span class="op">=</span><span class="st">"g"</span>)[<span class="st">'n'</span>]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>suit_2014 <span class="op">=</span> gs.parse_command(<span class="st">"r.univar"</span>, <span class="bu">map</span><span class="op">=</span><span class="st">"suitability_2014"</span>, flags<span class="op">=</span><span class="st">"g"</span>)[<span class="st">'n'</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>suit_2018 <span class="op">=</span> gs.parse_command(<span class="st">"r.univar"</span>, <span class="bu">map</span><span class="op">=</span><span class="st">"suitability_2018"</span>, flags<span class="op">=</span><span class="st">"g"</span>)[<span class="st">'n'</span>]</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>change <span class="op">=</span> ((<span class="bu">float</span>(suit_2018) <span class="op">-</span> <span class="bu">float</span>(suit_2014))<span class="op">/</span><span class="bu">float</span>(land_cells))<span class="op">*</span><span class="fl">100.0</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The increase in suitable area was </span><span class="sc">{</span>change<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="t.rast.accdetect" class="level2">
<h2 class="anchored" data-anchor-id="t.rast.accdetect"><a href="https://grass.osgeo.org/grass-stable/manuals/t.rast.accdetect.html">t.rast.accdetect</a></h2>
<p><em>t.rast.accdetect</em> is used to detect accumulation patterns in temporally accumulated STDRS created by t.rast.accumulate. The start and end time do not need to be the same but the cycle and offset options must be exactly the same that were used in the accumulation process that generated the input STRDS. Minimum and maximum values for pattern detection can be set either by using STRDS or fixed values for all raster cells and time steps (range option).</p>
<p>Using STRDS would allow specifying minimum and maximum values for each raster cell and each time step. For example, if you want to detect the germination (minimum value) and harvesting (maximum value) dates for different crops using the growing-degree-day (GDD) method for several years. Different crops may grow in different raster cells and change with time because of crop rotation. Hence we need to specify different GDD germination/harvesting (minimum/maximum) values for different raster cells and different years.</p>
<p><em>t.rast.accdetect</em> produces two output STRDS:</p>
<ul>
<li><strong>occurrence</strong>: The occurrence STRDS stores the time in days from the beginning of a given cycle for each raster. These values can be used to compute the duration of the recognized accumulation pattern.</li>
<li><strong>indicator</strong>: The indicator STRDS uses three integer values to mark raster cells as beginning (1), intermediate (2) state or end (3) of an accumulation pattern. These values can be used to identify places with complete cycles.</li>
</ul>
<section id="detection-of-mosquito-generations" class="level3">
<h3 class="anchored" data-anchor-id="detection-of-mosquito-generations">Detection of mosquito generations</h3>
<p>Following Kobashayi et al (2002), each mosquito generation might take around 365 DD. Let’s use this reference value to identify how many mosquito generations we could expect over our study area.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>cycle <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">10</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>cycle_beg <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">3286</span>, <span class="dv">365</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>cycle_end <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">365</span>, <span class="dv">3286</span>, <span class="dv">365</span>))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(cycle) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"cycle: </span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>cycle_beg[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>cycle_end[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Identify generations</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    gs.run_command(<span class="st">"t.rast.accdetect"</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">input</span><span class="op">=</span><span class="st">"mosq_daily_bedd"</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>                    occurrence<span class="op">=</span><span class="ss">f"mosq_occurrence_gen_</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>                    indicator<span class="op">=</span><span class="ss">f"mosq_indicator_gen_</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>                    basename<span class="op">=</span><span class="ss">f"mosq_gen_</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>                    start<span class="op">=</span><span class="st">"2014-01-01"</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>                    stop<span class="op">=</span><span class="st">"2019-01-01"</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>                    cycle<span class="op">=</span><span class="st">"12 months"</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">range</span><span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>cycle_beg[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>cycle_end[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>                      </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    gs.run_command(<span class="st">"t.rast.aggregate"</span>,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">input</span><span class="op">=</span><span class="ss">f"mosq_indicator_gen_</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>                    output<span class="op">=</span><span class="ss">f"mosq_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">_yearly"</span>,</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>                    basename<span class="op">=</span><span class="ss">f"mosq_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">_yearly"</span>,</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>                    granularity<span class="op">=</span><span class="st">"1 year"</span>,</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>                    method<span class="op">=</span><span class="st">"maximum"</span>, </span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                    suffix<span class="op">=</span><span class="st">"gran"</span>)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep only complete generations</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    exp<span class="op">=</span><span class="ss">f"if(mosq_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">_yearly == 3, </span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">, null())"</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    gs.run_command(<span class="st">"t.rast.mapcalc"</span>,</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">input</span><span class="op">=</span><span class="ss">f"mosq_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">_yearly"</span>,</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>                    output<span class="op">=</span><span class="ss">f"mosq_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">_yearly_clean"</span>,</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>                    basename<span class="op">=</span><span class="ss">f"mosq_clean_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>                    expression<span class="op">=</span>exp)</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Duration of each mosquito generation</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Beginning</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    gs.run_command(<span class="st">"t.rast.aggregate"</span>,</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">input</span><span class="op">=</span><span class="ss">f"mosq_occurrence_gen_</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>                    output<span class="op">=</span><span class="ss">f"mosq_min_day_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>                    basename<span class="op">=</span><span class="ss">f"occ_min_day_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>                    method<span class="op">=</span><span class="st">"minimum"</span>,</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>                    granularity<span class="op">=</span><span class="st">"1 year"</span>,</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>                    suffix<span class="op">=</span><span class="st">"gran"</span>)</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># End</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    gs.run_command(<span class="st">"t.rast.aggregate"</span>,</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">input</span><span class="op">=</span><span class="ss">f"mosq_occurrence_gen_</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>, </span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>                    output<span class="op">=</span><span class="ss">f"mosq_max_day_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>                    basename<span class="op">=</span><span class="ss">f"occ_max_day_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>                    method<span class="op">=</span><span class="st">"maximum"</span>,</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>                    granularity<span class="op">=</span><span class="st">"1 year"</span>,</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>                    suffix<span class="op">=</span><span class="st">"gran"</span>)</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Difference</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    exp<span class="op">=</span><span class="ss">f"mosq_max_day_gen$</span><span class="sc">{</span>cycle[$i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss"> - mosq_min_day_gen$</span><span class="sc">{</span>cycle[$i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss"> + 1"</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>    gs.run_command(<span class="st">"t.rast.mapcalc"</span>,</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">input</span><span class="op">=</span><span class="ss">f"mosq_min_day_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">,mosq_max_day_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>                    output<span class="op">=</span><span class="ss">f"mosq_duration_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>, </span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>                    basename<span class="op">=</span><span class="ss">f"mosq_duration_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>                    expression<span class="op">=</span>exp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s now see which is the maximum number of generations in each cell and their median duration per year.</p>
</section>
<section id="maximum-number-of-generations-per-year" class="level3">
<h3 class="anchored" data-anchor-id="maximum-number-of-generations-per-year">Maximum number of generations per year</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">6</span>):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    maps <span class="op">=</span> gs.list_grouped(<span class="bu">type</span><span class="op">=</span><span class="st">"raster"</span>, pattern<span class="op">=</span><span class="ss">f"mosq_clean_gen*_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    gs.run_command(<span class="st">"r.series"</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">input</span><span class="op">=</span>maps,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                    output<span class="op">=</span><span class="ss">f"mosq_max_n_generations_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                    method<span class="op">=</span><span class="st">"maximum"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s see an animation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List of average maps</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>map_list <span class="op">=</span> gs.list_grouped(<span class="bu">type</span><span class="op">=</span><span class="st">"raster"</span>, pattern<span class="op">=</span><span class="st">"mosq_max_n_generations_*"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Animation with SeriesMap class</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>series <span class="op">=</span> gj.SeriesMap(height <span class="op">=</span> <span class="dv">500</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>series.add_rasters(map_list)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>series.d_barscale()</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>series.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="median-duration-of-mosquito-generations-per-year" class="level3">
<h3 class="anchored" data-anchor-id="median-duration-of-mosquito-generations-per-year">Median duration of mosquito generations per year</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">6</span>):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    maps <span class="op">=</span> gs.list_grouped(<span class="bu">type</span><span class="op">=</span><span class="st">"raster"</span>, pattern<span class="op">=</span><span class="ss">f"mosq_duration_gen*_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    gs.run_command(<span class="st">"r.series"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">input</span><span class="op">=</span>maps,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                    output<span class="op">=</span><span class="ss">f"mosq_med_duration_generations_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                    method<span class="op">=</span><span class="st">"median"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s see an animation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List of average maps</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>map_list <span class="op">=</span> gs.list_grouped(<span class="bu">type</span><span class="op">=</span><span class="st">"raster"</span>, pattern<span class="op">=</span><span class="st">"mosq_med_duration_generations_*"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Animation with SeriesMap class</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>series <span class="op">=</span> gj.SeriesMap(height <span class="op">=</span> <span class="dv">500</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>series.add_rasters(map_list)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>series.d_barscale()</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>series.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now remove all intermediate series and maps:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>gs.run_command(<span class="st">"t.list"</span>, </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                <span class="bu">type</span><span class="op">=</span><span class="st">"strds"</span>, </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                where<span class="op">=</span><span class="st">"name LIKE '</span><span class="sc">%g</span><span class="st">en%'"</span>, </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                output<span class="op">=</span><span class="st">"to_remove.txt"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>gs.run_command(<span class="st">"t.remove"</span>, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                flags<span class="op">=</span><span class="st">"df"</span>, </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                <span class="bu">file</span><span class="op">=</span><span class="st">"to_remove.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li>Neteler, M., Metz, M., Rocchini, D., Rizzoli, A., Flacio, E., et al.&nbsp;2013. <em>Is Switzerland Suitable for the Invasion ofAedes albopictus?</em> PLOS ONE 8(12). <a href="https://doi.org/10.1371/journal.pone.0082090">DOI</a>.</li>
<li>Kobayashi, M., Nihei, N., Kurihara, T. 2002. <em>Analysis of Northern Distribution of <em>Aedes albopictus</em> (Diptera: Culicidae) in Japan by Geographical Information System.</em> Journal of Medical Entomology 39(1), 4–11. <a href="https://doi.org/10.1603/0022-2585-39.1.4">DOI</a>.</li>
<li>Gebbert, S., Pebesma, E. 2014. <em>TGRASS: A temporal GIS for field based environmental modeling.</em> Environmental Modelling &amp; Software 53, 1-12. <a href="http://dx.doi.org/10.1016/j.envsoft.2013.11.001">DOI</a>.</li>
<li>Gebbert, S., Pebesma, E. 2017. <em>The GRASS GIS temporal framework.</em> International Journal of Geographical Information Science 31, 1273-1292. <a href="http://dx.doi.org/10.1080/13658816.2017.1306862">DOI</a>.</li>
<li><a href="https://grasswiki.osgeo.org/wiki/Temporal_data_processing">Temporal data processing</a> wiki page.</li>
</ul>
<hr>
<div class="smaller">
<p>The development of this tutorial was funded by the US <a href="https://www.nsf.gov/">National Science Foundation (NSF)</a>, award <a href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=2303651">2303651</a>.</p>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb15" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Time series accumulations"</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Veronica Andreo"</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="an">date-modified:</span><span class="co"> today</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [GRASS GIS, Time series, raster, Advanced, Python]</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="an">engine:</span><span class="co"> knitr</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">  eval: false</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>In this fourth part of the time series tutorials, we will go through data </span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>accumulation. We'll mostly follow a modified version of the example </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>presented in the </span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">t.rast.accumulate</span><span class="co">](https://grass.osgeo.org/grass-stable/manuals/t.rast.accumulate.html)</span> </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>and <span class="co">[</span><span class="ot">t.rast.accdetect</span><span class="co">](https://grass.osgeo.org/grass-stable/manuals/t.rast.accdetect.html)</span> </span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>tools.</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>::: {.callout-note title="Setup"}</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>This tutorial can be run locally or in Google Colab. However, make sure you</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>install GRASS GIS 8.4+, download the LST sample data and set up your project</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>as explained in the <span class="co">[</span><span class="ot">first part</span><span class="co">](time_series_management_and_visualization.qmd)</span> </span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>of these time series tutorials.</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a><span class="co"># GRASS GIS database variables</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>grassbin <span class="op">=</span> <span class="st">"grass-dev"</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>grassdata <span class="op">=</span> os.path.join(os.path.expanduser(<span class="st">'~'</span>), <span class="st">"grassdata"</span>)</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>project <span class="op">=</span> <span class="st">"eu_laea"</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>mapset <span class="op">=</span> <span class="st">"italy_LST_daily"</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>sys.path.append(</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>    subprocess.check_output([grassbin, <span class="st">"--config"</span>, <span class="st">"python_path"</span>], text<span class="op">=</span><span class="va">True</span>).strip()</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the GRASS GIS packages we need</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> grass.script <span class="im">as</span> gs</span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> grass.jupyter <span class="im">as</span> gj</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Start the GRASS GIS Session</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>session <span class="op">=</span> gj.init(grassdata, project, mapset)<span class="op">;</span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a><span class="fu">## [t.rast.accumulate](https://grass.osgeo.org/grass-stable/manuals/t.rast.accumulate.html)</span></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>*t.rast.accumulate* performs temporal accumulations of raster time series. </span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>Data accumulations are common in ecology or agriculture, especially temperature</span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>accumulation. Usually, to determine if insects or plants can survive in a certain</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>place, a measure of accumulated temperature is used. For example, a certain plant </span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>species might need x GDD to bloom, or a mosquito species might need x GDD to </span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a>complete their development from egg to adult. Therefore, it is usual to accumulate</span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a>temperature data, but other variables can be accumulated too, e.g. chlorophyll</span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>concentration to determine algal bloom occurrences in water bodies.</span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a>*t.rast.accumulate* expects a STRDS as input that will be sampled by a given </span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a>granularity. All maps that have the start time during the actual granule will </span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a>be accumulated with the predecessor granule accumulation result using the raster</span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a>module r.series.accumulate. The default granularity is 1 day, but any temporal </span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a>granularity can be set. </span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a>The start time and the end time of the accumulation process must be set. In </span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a>addition, a cycle can be specified that defines after which interval of time </span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a>the accumulation process restarts. The offset option specifies the time that </span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a>should be skipped between two cycles.</span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a>The lower and upper limits of the accumulation process can be set, either by </span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a>using space time raster datasets or by using fixed values for all raster cells</span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a>and time steps by means of the limits option is used, eg. limits=10,30. The </span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a>upper limit is only used in the Biologically Effective Degree Days calculation.</span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a>The output is a new space time raster dataset with the provided start time, </span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a>end time and granularity containing the accumulated raster maps. </span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a><span class="fu">### Accumulation using BEDD</span></span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-98"><a href="#cb15-98" aria-hidden="true" tabindex="-1"></a>Let's consider the mosquito *Aedes albopictus*. Adults require a minimum average</span>
<span id="cb15-99"><a href="#cb15-99" aria-hidden="true" tabindex="-1"></a>temperature of 11 °C to survive. We will compute the Biologically Effective </span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true" tabindex="-1"></a>Degree Days (BEDD) from 2014 until 2018 for each year with a granularity of </span>
<span id="cb15-101"><a href="#cb15-101" aria-hidden="true" tabindex="-1"></a>one day. </span>
<span id="cb15-102"><a href="#cb15-102" aria-hidden="true" tabindex="-1"></a>The base temperature will be 11°C, and the upper limit 30°C where adult mosquito</span>
<span id="cb15-103"><a href="#cb15-103" aria-hidden="true" tabindex="-1"></a>survival is known to decrease. Hence the accumulation will start at 11°C and stop </span>
<span id="cb15-104"><a href="#cb15-104" aria-hidden="true" tabindex="-1"></a>at 30°C.</span>
<span id="cb15-105"><a href="#cb15-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-108"><a href="#cb15-108" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb15-109"><a href="#cb15-109" aria-hidden="true" tabindex="-1"></a><span class="co"># Accumulation of degree days</span></span>
<span id="cb15-110"><a href="#cb15-110" aria-hidden="true" tabindex="-1"></a>gs.run_command(<span class="st">"t.rast.accumulate"</span>,</span>
<span id="cb15-111"><a href="#cb15-111" aria-hidden="true" tabindex="-1"></a>               <span class="bu">input</span><span class="op">=</span><span class="st">"lst_daily"</span>,</span>
<span id="cb15-112"><a href="#cb15-112" aria-hidden="true" tabindex="-1"></a>               output<span class="op">=</span><span class="st">"mosq_daily_bedd"</span>,</span>
<span id="cb15-113"><a href="#cb15-113" aria-hidden="true" tabindex="-1"></a>               basename<span class="op">=</span><span class="st">"mosq_daily_bedd"</span>,</span>
<span id="cb15-114"><a href="#cb15-114" aria-hidden="true" tabindex="-1"></a>               suffix<span class="op">=</span><span class="st">"gran"</span>,</span>
<span id="cb15-115"><a href="#cb15-115" aria-hidden="true" tabindex="-1"></a>               start<span class="op">=</span><span class="st">"2014-01-01"</span>,</span>
<span id="cb15-116"><a href="#cb15-116" aria-hidden="true" tabindex="-1"></a>               stop<span class="op">=</span><span class="st">"2019-01-01"</span>,</span>
<span id="cb15-117"><a href="#cb15-117" aria-hidden="true" tabindex="-1"></a>               cycle<span class="op">=</span><span class="st">"12 months"</span>,</span>
<span id="cb15-118"><a href="#cb15-118" aria-hidden="true" tabindex="-1"></a>               method<span class="op">=</span><span class="st">"bedd"</span>, </span>
<span id="cb15-119"><a href="#cb15-119" aria-hidden="true" tabindex="-1"></a>               limits<span class="op">=</span><span class="st">"11,30"</span>)</span>
<span id="cb15-120"><a href="#cb15-120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-121"><a href="#cb15-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-124"><a href="#cb15-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb15-125"><a href="#cb15-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Get basic info</span></span>
<span id="cb15-126"><a href="#cb15-126" aria-hidden="true" tabindex="-1"></a>gs.run_command(<span class="st">"t.info"</span>, <span class="bu">input</span><span class="op">=</span><span class="st">"mosq_daily_bedd"</span>)</span>
<span id="cb15-127"><a href="#cb15-127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-128"><a href="#cb15-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-129"><a href="#cb15-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-130"><a href="#cb15-130" aria-hidden="true" tabindex="-1"></a><span class="fu">### Suitable areas for mosquitos</span></span>
<span id="cb15-131"><a href="#cb15-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-132"><a href="#cb15-132" aria-hidden="true" tabindex="-1"></a>According to Kobashayi et al (2002), populations of *Aedes albopictus* </span>
<span id="cb15-133"><a href="#cb15-133" aria-hidden="true" tabindex="-1"></a>establish where at least 1350 DD are accumulated. These DD should be reached </span>
<span id="cb15-134"><a href="#cb15-134" aria-hidden="true" tabindex="-1"></a>before Oct 1st to consider a place as suitable. Let's find out when and where </span>
<span id="cb15-135"><a href="#cb15-135" aria-hidden="true" tabindex="-1"></a>that condition is met.</span>
<span id="cb15-136"><a href="#cb15-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-137"><a href="#cb15-137" aria-hidden="true" tabindex="-1"></a>We will first discard all cells with BEDD &lt; 1350 from our accumulated time </span>
<span id="cb15-138"><a href="#cb15-138" aria-hidden="true" tabindex="-1"></a>series, and then we will save the day of the year (DOY) where BEDD &gt;=</span>
<span id="cb15-139"><a href="#cb15-139" aria-hidden="true" tabindex="-1"></a><span class="ss">1350. </span></span>
<span id="cb15-140"><a href="#cb15-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-143"><a href="#cb15-143" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb15-144"><a href="#cb15-144" aria-hidden="true" tabindex="-1"></a>exp<span class="op">=</span><span class="st">"doy_bedd_higher_1350 = if(mosq_daily_bedd &gt;= 1350, start_doy(mosq_daily_bedd, 0), null())"</span></span>
<span id="cb15-145"><a href="#cb15-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-146"><a href="#cb15-146" aria-hidden="true" tabindex="-1"></a>gs.run_command(<span class="st">"t.rast.algebra"</span>,</span>
<span id="cb15-147"><a href="#cb15-147" aria-hidden="true" tabindex="-1"></a>               expression<span class="op">=</span>exp,</span>
<span id="cb15-148"><a href="#cb15-148" aria-hidden="true" tabindex="-1"></a>               basename<span class="op">=</span><span class="st">"doy_bedd_higher_1350"</span>,</span>
<span id="cb15-149"><a href="#cb15-149" aria-hidden="true" tabindex="-1"></a>               suffix<span class="op">=</span><span class="st">"gran"</span>,</span>
<span id="cb15-150"><a href="#cb15-150" aria-hidden="true" tabindex="-1"></a>               nprocs<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb15-151"><a href="#cb15-151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-152"><a href="#cb15-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-153"><a href="#cb15-153" aria-hidden="true" tabindex="-1"></a>Then, we aggregate the <span class="in">`doy_bedd_higher_1350`</span> STRDS on an annual basis, as we want </span>
<span id="cb15-154"><a href="#cb15-154" aria-hidden="true" tabindex="-1"></a>to see possible changes among years. We use <span class="in">`method=minimum`</span> to get the earliest</span>
<span id="cb15-155"><a href="#cb15-155" aria-hidden="true" tabindex="-1"></a>day on which the condition is met each year.</span>
<span id="cb15-156"><a href="#cb15-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-159"><a href="#cb15-159" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb15-160"><a href="#cb15-160" aria-hidden="true" tabindex="-1"></a>gs.run_command(<span class="st">"t.rast.aggregate"</span>,</span>
<span id="cb15-161"><a href="#cb15-161" aria-hidden="true" tabindex="-1"></a>               <span class="bu">input</span><span class="op">=</span><span class="st">"doy_bedd_higher_1350"</span>,</span>
<span id="cb15-162"><a href="#cb15-162" aria-hidden="true" tabindex="-1"></a>               method<span class="op">=</span><span class="st">"minimum"</span>,</span>
<span id="cb15-163"><a href="#cb15-163" aria-hidden="true" tabindex="-1"></a>               granularity<span class="op">=</span><span class="st">"1 year"</span>,</span>
<span id="cb15-164"><a href="#cb15-164" aria-hidden="true" tabindex="-1"></a>               output<span class="op">=</span><span class="st">"annual_doy_bedd_higher_1350"</span>,</span>
<span id="cb15-165"><a href="#cb15-165" aria-hidden="true" tabindex="-1"></a>               basename<span class="op">=</span><span class="st">"annual_doy_bedd_higher_1350"</span>,</span>
<span id="cb15-166"><a href="#cb15-166" aria-hidden="true" tabindex="-1"></a>               suffix<span class="op">=</span><span class="st">"gran"</span>,</span>
<span id="cb15-167"><a href="#cb15-167" aria-hidden="true" tabindex="-1"></a>               nprocs<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb15-168"><a href="#cb15-168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-169"><a href="#cb15-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-172"><a href="#cb15-172" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb15-173"><a href="#cb15-173" aria-hidden="true" tabindex="-1"></a>gs.run_command(<span class="st">"t.rast.list"</span>,</span>
<span id="cb15-174"><a href="#cb15-174" aria-hidden="true" tabindex="-1"></a>                <span class="bu">input</span><span class="op">=</span><span class="st">"annual_doy_bedd_higher_1350"</span>,</span>
<span id="cb15-175"><a href="#cb15-175" aria-hidden="true" tabindex="-1"></a>                columns<span class="op">=</span><span class="st">"id,min,max"</span>)</span>
<span id="cb15-176"><a href="#cb15-176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-177"><a href="#cb15-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-178"><a href="#cb15-178" aria-hidden="true" tabindex="-1"></a>Following Neteler et al (2013), if the 1350 DD are achieved on or before August </span>
<span id="cb15-179"><a href="#cb15-179" aria-hidden="true" tabindex="-1"></a>1st, a place is considered highly suitable for *Aedes albopictus*, while if the</span>
<span id="cb15-180"><a href="#cb15-180" aria-hidden="true" tabindex="-1"></a>condition is met after October 1st, the place is not suitable. </span>
<span id="cb15-181"><a href="#cb15-181" aria-hidden="true" tabindex="-1"></a>Everything in between is defined as a linear function of DOY. Once again, we use</span>
<span id="cb15-182"><a href="#cb15-182" aria-hidden="true" tabindex="-1"></a>the temporal algebra to create yearly suitability maps. Note we are using a </span>
<span id="cb15-183"><a href="#cb15-183" aria-hidden="true" tabindex="-1"></a>nested if statement.</span>
<span id="cb15-184"><a href="#cb15-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-187"><a href="#cb15-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb15-188"><a href="#cb15-188" aria-hidden="true" tabindex="-1"></a>expression<span class="op">=</span><span class="st">"suitability = if(annual_doy_bedd_higher_1350 &lt;= 214, 1, if(annual_doy_bedd_higher_1350 &gt; 214 &amp;&amp; annual_doy_bedd_higher_1350 &lt;= 274, (274 - annual_doy_bedd_higher_1350)/60.0, if(annual_doy_bedd_higher_1350 &gt; 274, 0)))"</span></span>
<span id="cb15-189"><a href="#cb15-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-190"><a href="#cb15-190" aria-hidden="true" tabindex="-1"></a>gs.run_command(<span class="st">"t.rast.algebra"</span>,</span>
<span id="cb15-191"><a href="#cb15-191" aria-hidden="true" tabindex="-1"></a>               expression<span class="op">=</span>expression,</span>
<span id="cb15-192"><a href="#cb15-192" aria-hidden="true" tabindex="-1"></a>               basename<span class="op">=</span><span class="st">"suitability"</span>,</span>
<span id="cb15-193"><a href="#cb15-193" aria-hidden="true" tabindex="-1"></a>               suffix<span class="op">=</span><span class="st">"gran"</span>,</span>
<span id="cb15-194"><a href="#cb15-194" aria-hidden="true" tabindex="-1"></a>               nprocs<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb15-195"><a href="#cb15-195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-196"><a href="#cb15-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-197"><a href="#cb15-197" aria-hidden="true" tabindex="-1"></a>Let's see how suitable area and suitability values change with time by means of </span>
<span id="cb15-198"><a href="#cb15-198" aria-hidden="true" tabindex="-1"></a>an animation.</span>
<span id="cb15-199"><a href="#cb15-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-202"><a href="#cb15-202" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb15-203"><a href="#cb15-203" aria-hidden="true" tabindex="-1"></a><span class="co"># Animation of annual anomalies</span></span>
<span id="cb15-204"><a href="#cb15-204" aria-hidden="true" tabindex="-1"></a>suitability <span class="op">=</span> gj.TimeSeriesMap(use_region<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-205"><a href="#cb15-205" aria-hidden="true" tabindex="-1"></a>suitability.add_raster_series(<span class="st">"suitability"</span>, fill_gaps<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb15-206"><a href="#cb15-206" aria-hidden="true" tabindex="-1"></a>suitability.d_legend(color<span class="op">=</span><span class="st">"black"</span>, at<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">40</span>,<span class="dv">2</span>,<span class="dv">6</span>))</span>
<span id="cb15-207"><a href="#cb15-207" aria-hidden="true" tabindex="-1"></a>suitability.show()</span>
<span id="cb15-208"><a href="#cb15-208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-209"><a href="#cb15-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-210"><a href="#cb15-210" aria-hidden="true" tabindex="-1"></a>Impressive, ah? Let's do some basic math to quantify the suitable area increase</span>
<span id="cb15-211"><a href="#cb15-211" aria-hidden="true" tabindex="-1"></a>from 2014 to 2018. We use <span class="in">`r.univar`</span> to get the number of non-null cells in each</span>
<span id="cb15-212"><a href="#cb15-212" aria-hidden="true" tabindex="-1"></a>map.</span>
<span id="cb15-213"><a href="#cb15-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-216"><a href="#cb15-216" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb15-217"><a href="#cb15-217" aria-hidden="true" tabindex="-1"></a>land_cells <span class="op">=</span> gs.parse_command(<span class="st">"r.univar"</span>, <span class="bu">map</span><span class="op">=</span><span class="st">"lst_2014.001_avg"</span>, flags<span class="op">=</span><span class="st">"g"</span>)[<span class="st">'n'</span>]</span>
<span id="cb15-218"><a href="#cb15-218" aria-hidden="true" tabindex="-1"></a>suit_2014 <span class="op">=</span> gs.parse_command(<span class="st">"r.univar"</span>, <span class="bu">map</span><span class="op">=</span><span class="st">"suitability_2014"</span>, flags<span class="op">=</span><span class="st">"g"</span>)[<span class="st">'n'</span>]</span>
<span id="cb15-219"><a href="#cb15-219" aria-hidden="true" tabindex="-1"></a>suit_2018 <span class="op">=</span> gs.parse_command(<span class="st">"r.univar"</span>, <span class="bu">map</span><span class="op">=</span><span class="st">"suitability_2018"</span>, flags<span class="op">=</span><span class="st">"g"</span>)[<span class="st">'n'</span>]</span>
<span id="cb15-220"><a href="#cb15-220" aria-hidden="true" tabindex="-1"></a>change <span class="op">=</span> ((<span class="bu">float</span>(suit_2018) <span class="op">-</span> <span class="bu">float</span>(suit_2014))<span class="op">/</span><span class="bu">float</span>(land_cells))<span class="op">*</span><span class="fl">100.0</span></span>
<span id="cb15-221"><a href="#cb15-221" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The increase in suitable area was </span><span class="sc">{</span>change<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-222"><a href="#cb15-222" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-223"><a href="#cb15-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-224"><a href="#cb15-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-225"><a href="#cb15-225" aria-hidden="true" tabindex="-1"></a><span class="fu">## [t.rast.accdetect](https://grass.osgeo.org/grass-stable/manuals/t.rast.accdetect.html)</span></span>
<span id="cb15-226"><a href="#cb15-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-227"><a href="#cb15-227" aria-hidden="true" tabindex="-1"></a>*t.rast.accdetect* is used to detect accumulation patterns in temporally </span>
<span id="cb15-228"><a href="#cb15-228" aria-hidden="true" tabindex="-1"></a>accumulated STDRS created by t.rast.accumulate. The start and end time do not </span>
<span id="cb15-229"><a href="#cb15-229" aria-hidden="true" tabindex="-1"></a>need to be the same but the cycle and offset options must be exactly the same </span>
<span id="cb15-230"><a href="#cb15-230" aria-hidden="true" tabindex="-1"></a>that were used in the accumulation process that generated the input STRDS.</span>
<span id="cb15-231"><a href="#cb15-231" aria-hidden="true" tabindex="-1"></a>Minimum and maximum values for pattern detection can be set either by using </span>
<span id="cb15-232"><a href="#cb15-232" aria-hidden="true" tabindex="-1"></a>STRDS or fixed values for all raster cells and time steps (range option).</span>
<span id="cb15-233"><a href="#cb15-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-234"><a href="#cb15-234" aria-hidden="true" tabindex="-1"></a>Using STRDS would allow specifying minimum and maximum values for each raster </span>
<span id="cb15-235"><a href="#cb15-235" aria-hidden="true" tabindex="-1"></a>cell and each time step. For example, if you want to detect the germination </span>
<span id="cb15-236"><a href="#cb15-236" aria-hidden="true" tabindex="-1"></a>(minimum value) and harvesting (maximum value) dates for different crops using</span>
<span id="cb15-237"><a href="#cb15-237" aria-hidden="true" tabindex="-1"></a>the growing-degree-day (GDD) method for several years. Different crops may </span>
<span id="cb15-238"><a href="#cb15-238" aria-hidden="true" tabindex="-1"></a>grow in different raster cells and change with time because of crop rotation. </span>
<span id="cb15-239"><a href="#cb15-239" aria-hidden="true" tabindex="-1"></a>Hence we need to specify different GDD germination/harvesting (minimum/maximum) </span>
<span id="cb15-240"><a href="#cb15-240" aria-hidden="true" tabindex="-1"></a>values for different raster cells and different years.</span>
<span id="cb15-241"><a href="#cb15-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-242"><a href="#cb15-242" aria-hidden="true" tabindex="-1"></a>*t.rast.accdetect* produces two output STRDS: </span>
<span id="cb15-243"><a href="#cb15-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-244"><a href="#cb15-244" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**occurrence**: The occurrence STRDS stores the time in days from the beginning of a given cycle for each raster. These values can be used to compute the duration of the recognized accumulation pattern.</span>
<span id="cb15-245"><a href="#cb15-245" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**indicator**: The indicator STRDS uses three integer values to mark raster cells as beginning (1), intermediate (2) state or end (3) of an accumulation pattern. These values can be used to identify places with complete cycles.</span>
<span id="cb15-246"><a href="#cb15-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-247"><a href="#cb15-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-248"><a href="#cb15-248" aria-hidden="true" tabindex="-1"></a><span class="fu">### Detection of mosquito generations</span></span>
<span id="cb15-249"><a href="#cb15-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-250"><a href="#cb15-250" aria-hidden="true" tabindex="-1"></a>Following Kobashayi et al (2002), each mosquito generation might take around</span>
<span id="cb15-251"><a href="#cb15-251" aria-hidden="true" tabindex="-1"></a>365 DD. Let's use this reference value to identify how many mosquito </span>
<span id="cb15-252"><a href="#cb15-252" aria-hidden="true" tabindex="-1"></a>generations we could expect over our study area. </span>
<span id="cb15-253"><a href="#cb15-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-256"><a href="#cb15-256" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb15-257"><a href="#cb15-257" aria-hidden="true" tabindex="-1"></a>cycle <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">10</span>))</span>
<span id="cb15-258"><a href="#cb15-258" aria-hidden="true" tabindex="-1"></a>cycle_beg <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">3286</span>, <span class="dv">365</span>))</span>
<span id="cb15-259"><a href="#cb15-259" aria-hidden="true" tabindex="-1"></a>cycle_end <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">365</span>, <span class="dv">3286</span>, <span class="dv">365</span>))</span>
<span id="cb15-260"><a href="#cb15-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-261"><a href="#cb15-261" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(cycle) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb15-262"><a href="#cb15-262" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-263"><a href="#cb15-263" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"cycle: </span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>cycle_beg[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>cycle_end[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-264"><a href="#cb15-264" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-265"><a href="#cb15-265" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Identify generations</span></span>
<span id="cb15-266"><a href="#cb15-266" aria-hidden="true" tabindex="-1"></a>    gs.run_command(<span class="st">"t.rast.accdetect"</span>,</span>
<span id="cb15-267"><a href="#cb15-267" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">input</span><span class="op">=</span><span class="st">"mosq_daily_bedd"</span>,</span>
<span id="cb15-268"><a href="#cb15-268" aria-hidden="true" tabindex="-1"></a>                    occurrence<span class="op">=</span><span class="ss">f"mosq_occurrence_gen_</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb15-269"><a href="#cb15-269" aria-hidden="true" tabindex="-1"></a>                    indicator<span class="op">=</span><span class="ss">f"mosq_indicator_gen_</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb15-270"><a href="#cb15-270" aria-hidden="true" tabindex="-1"></a>                    basename<span class="op">=</span><span class="ss">f"mosq_gen_</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb15-271"><a href="#cb15-271" aria-hidden="true" tabindex="-1"></a>                    start<span class="op">=</span><span class="st">"2014-01-01"</span>,</span>
<span id="cb15-272"><a href="#cb15-272" aria-hidden="true" tabindex="-1"></a>                    stop<span class="op">=</span><span class="st">"2019-01-01"</span>,</span>
<span id="cb15-273"><a href="#cb15-273" aria-hidden="true" tabindex="-1"></a>                    cycle<span class="op">=</span><span class="st">"12 months"</span>,</span>
<span id="cb15-274"><a href="#cb15-274" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">range</span><span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>cycle_beg[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>cycle_end[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-275"><a href="#cb15-275" aria-hidden="true" tabindex="-1"></a>                      </span>
<span id="cb15-276"><a href="#cb15-276" aria-hidden="true" tabindex="-1"></a>    gs.run_command(<span class="st">"t.rast.aggregate"</span>,</span>
<span id="cb15-277"><a href="#cb15-277" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">input</span><span class="op">=</span><span class="ss">f"mosq_indicator_gen_</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb15-278"><a href="#cb15-278" aria-hidden="true" tabindex="-1"></a>                    output<span class="op">=</span><span class="ss">f"mosq_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">_yearly"</span>,</span>
<span id="cb15-279"><a href="#cb15-279" aria-hidden="true" tabindex="-1"></a>                    basename<span class="op">=</span><span class="ss">f"mosq_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">_yearly"</span>,</span>
<span id="cb15-280"><a href="#cb15-280" aria-hidden="true" tabindex="-1"></a>                    granularity<span class="op">=</span><span class="st">"1 year"</span>,</span>
<span id="cb15-281"><a href="#cb15-281" aria-hidden="true" tabindex="-1"></a>                    method<span class="op">=</span><span class="st">"maximum"</span>, </span>
<span id="cb15-282"><a href="#cb15-282" aria-hidden="true" tabindex="-1"></a>                    suffix<span class="op">=</span><span class="st">"gran"</span>)</span>
<span id="cb15-283"><a href="#cb15-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-284"><a href="#cb15-284" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep only complete generations</span></span>
<span id="cb15-285"><a href="#cb15-285" aria-hidden="true" tabindex="-1"></a>    exp<span class="op">=</span><span class="ss">f"if(mosq_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">_yearly == 3, </span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">, null())"</span></span>
<span id="cb15-286"><a href="#cb15-286" aria-hidden="true" tabindex="-1"></a>    gs.run_command(<span class="st">"t.rast.mapcalc"</span>,</span>
<span id="cb15-287"><a href="#cb15-287" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">input</span><span class="op">=</span><span class="ss">f"mosq_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">_yearly"</span>,</span>
<span id="cb15-288"><a href="#cb15-288" aria-hidden="true" tabindex="-1"></a>                    output<span class="op">=</span><span class="ss">f"mosq_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">_yearly_clean"</span>,</span>
<span id="cb15-289"><a href="#cb15-289" aria-hidden="true" tabindex="-1"></a>                    basename<span class="op">=</span><span class="ss">f"mosq_clean_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb15-290"><a href="#cb15-290" aria-hidden="true" tabindex="-1"></a>                    expression<span class="op">=</span>exp)</span>
<span id="cb15-291"><a href="#cb15-291" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-292"><a href="#cb15-292" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Duration of each mosquito generation</span></span>
<span id="cb15-293"><a href="#cb15-293" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Beginning</span></span>
<span id="cb15-294"><a href="#cb15-294" aria-hidden="true" tabindex="-1"></a>    gs.run_command(<span class="st">"t.rast.aggregate"</span>,</span>
<span id="cb15-295"><a href="#cb15-295" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">input</span><span class="op">=</span><span class="ss">f"mosq_occurrence_gen_</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb15-296"><a href="#cb15-296" aria-hidden="true" tabindex="-1"></a>                    output<span class="op">=</span><span class="ss">f"mosq_min_day_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb15-297"><a href="#cb15-297" aria-hidden="true" tabindex="-1"></a>                    basename<span class="op">=</span><span class="ss">f"occ_min_day_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb15-298"><a href="#cb15-298" aria-hidden="true" tabindex="-1"></a>                    method<span class="op">=</span><span class="st">"minimum"</span>,</span>
<span id="cb15-299"><a href="#cb15-299" aria-hidden="true" tabindex="-1"></a>                    granularity<span class="op">=</span><span class="st">"1 year"</span>,</span>
<span id="cb15-300"><a href="#cb15-300" aria-hidden="true" tabindex="-1"></a>                    suffix<span class="op">=</span><span class="st">"gran"</span>)</span>
<span id="cb15-301"><a href="#cb15-301" aria-hidden="true" tabindex="-1"></a>    <span class="co"># End</span></span>
<span id="cb15-302"><a href="#cb15-302" aria-hidden="true" tabindex="-1"></a>    gs.run_command(<span class="st">"t.rast.aggregate"</span>,</span>
<span id="cb15-303"><a href="#cb15-303" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">input</span><span class="op">=</span><span class="ss">f"mosq_occurrence_gen_</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>, </span>
<span id="cb15-304"><a href="#cb15-304" aria-hidden="true" tabindex="-1"></a>                    output<span class="op">=</span><span class="ss">f"mosq_max_day_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb15-305"><a href="#cb15-305" aria-hidden="true" tabindex="-1"></a>                    basename<span class="op">=</span><span class="ss">f"occ_max_day_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb15-306"><a href="#cb15-306" aria-hidden="true" tabindex="-1"></a>                    method<span class="op">=</span><span class="st">"maximum"</span>,</span>
<span id="cb15-307"><a href="#cb15-307" aria-hidden="true" tabindex="-1"></a>                    granularity<span class="op">=</span><span class="st">"1 year"</span>,</span>
<span id="cb15-308"><a href="#cb15-308" aria-hidden="true" tabindex="-1"></a>                    suffix<span class="op">=</span><span class="st">"gran"</span>)</span>
<span id="cb15-309"><a href="#cb15-309" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Difference</span></span>
<span id="cb15-310"><a href="#cb15-310" aria-hidden="true" tabindex="-1"></a>    exp<span class="op">=</span><span class="ss">f"mosq_max_day_gen$</span><span class="sc">{</span>cycle[$i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss"> - mosq_min_day_gen$</span><span class="sc">{</span>cycle[$i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss"> + 1"</span></span>
<span id="cb15-311"><a href="#cb15-311" aria-hidden="true" tabindex="-1"></a>    gs.run_command(<span class="st">"t.rast.mapcalc"</span>,</span>
<span id="cb15-312"><a href="#cb15-312" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">input</span><span class="op">=</span><span class="ss">f"mosq_min_day_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">,mosq_max_day_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb15-313"><a href="#cb15-313" aria-hidden="true" tabindex="-1"></a>                    output<span class="op">=</span><span class="ss">f"mosq_duration_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>, </span>
<span id="cb15-314"><a href="#cb15-314" aria-hidden="true" tabindex="-1"></a>                    basename<span class="op">=</span><span class="ss">f"mosq_duration_gen</span><span class="sc">{</span>cycle[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb15-315"><a href="#cb15-315" aria-hidden="true" tabindex="-1"></a>                    expression<span class="op">=</span>exp)</span>
<span id="cb15-316"><a href="#cb15-316" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-317"><a href="#cb15-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-318"><a href="#cb15-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-319"><a href="#cb15-319" aria-hidden="true" tabindex="-1"></a>Let's now see which is the maximum number of generations in each cell and their </span>
<span id="cb15-320"><a href="#cb15-320" aria-hidden="true" tabindex="-1"></a>median duration per year.</span>
<span id="cb15-321"><a href="#cb15-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-322"><a href="#cb15-322" aria-hidden="true" tabindex="-1"></a><span class="fu">### Maximum number of generations per year</span></span>
<span id="cb15-323"><a href="#cb15-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-326"><a href="#cb15-326" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb15-327"><a href="#cb15-327" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">6</span>):</span>
<span id="cb15-328"><a href="#cb15-328" aria-hidden="true" tabindex="-1"></a>    maps <span class="op">=</span> gs.list_grouped(<span class="bu">type</span><span class="op">=</span><span class="st">"raster"</span>, pattern<span class="op">=</span><span class="ss">f"mosq_clean_gen*_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-329"><a href="#cb15-329" aria-hidden="true" tabindex="-1"></a>    gs.run_command(<span class="st">"r.series"</span>,</span>
<span id="cb15-330"><a href="#cb15-330" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">input</span><span class="op">=</span>maps,</span>
<span id="cb15-331"><a href="#cb15-331" aria-hidden="true" tabindex="-1"></a>                    output<span class="op">=</span><span class="ss">f"mosq_max_n_generations_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb15-332"><a href="#cb15-332" aria-hidden="true" tabindex="-1"></a>                    method<span class="op">=</span><span class="st">"maximum"</span>)</span>
<span id="cb15-333"><a href="#cb15-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-334"><a href="#cb15-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-335"><a href="#cb15-335" aria-hidden="true" tabindex="-1"></a>Let's see an animation:</span>
<span id="cb15-336"><a href="#cb15-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-339"><a href="#cb15-339" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb15-340"><a href="#cb15-340" aria-hidden="true" tabindex="-1"></a><span class="co"># List of average maps</span></span>
<span id="cb15-341"><a href="#cb15-341" aria-hidden="true" tabindex="-1"></a>map_list <span class="op">=</span> gs.list_grouped(<span class="bu">type</span><span class="op">=</span><span class="st">"raster"</span>, pattern<span class="op">=</span><span class="st">"mosq_max_n_generations_*"</span>)</span>
<span id="cb15-342"><a href="#cb15-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-343"><a href="#cb15-343" aria-hidden="true" tabindex="-1"></a><span class="co"># Animation with SeriesMap class</span></span>
<span id="cb15-344"><a href="#cb15-344" aria-hidden="true" tabindex="-1"></a>series <span class="op">=</span> gj.SeriesMap(height <span class="op">=</span> <span class="dv">500</span>)</span>
<span id="cb15-345"><a href="#cb15-345" aria-hidden="true" tabindex="-1"></a>series.add_rasters(map_list)</span>
<span id="cb15-346"><a href="#cb15-346" aria-hidden="true" tabindex="-1"></a>series.d_barscale()</span>
<span id="cb15-347"><a href="#cb15-347" aria-hidden="true" tabindex="-1"></a>series.show()</span>
<span id="cb15-348"><a href="#cb15-348" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-349"><a href="#cb15-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-350"><a href="#cb15-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-351"><a href="#cb15-351" aria-hidden="true" tabindex="-1"></a><span class="fu">### Median duration of mosquito generations per year</span></span>
<span id="cb15-352"><a href="#cb15-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-355"><a href="#cb15-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb15-356"><a href="#cb15-356" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">6</span>):</span>
<span id="cb15-357"><a href="#cb15-357" aria-hidden="true" tabindex="-1"></a>    maps <span class="op">=</span> gs.list_grouped(<span class="bu">type</span><span class="op">=</span><span class="st">"raster"</span>, pattern<span class="op">=</span><span class="ss">f"mosq_duration_gen*_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-358"><a href="#cb15-358" aria-hidden="true" tabindex="-1"></a>    gs.run_command(<span class="st">"r.series"</span>,</span>
<span id="cb15-359"><a href="#cb15-359" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">input</span><span class="op">=</span>maps,</span>
<span id="cb15-360"><a href="#cb15-360" aria-hidden="true" tabindex="-1"></a>                    output<span class="op">=</span><span class="ss">f"mosq_med_duration_generations_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb15-361"><a href="#cb15-361" aria-hidden="true" tabindex="-1"></a>                    method<span class="op">=</span><span class="st">"median"</span>)</span>
<span id="cb15-362"><a href="#cb15-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-363"><a href="#cb15-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-364"><a href="#cb15-364" aria-hidden="true" tabindex="-1"></a>Let's see an animation:</span>
<span id="cb15-365"><a href="#cb15-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-368"><a href="#cb15-368" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb15-369"><a href="#cb15-369" aria-hidden="true" tabindex="-1"></a><span class="co"># List of average maps</span></span>
<span id="cb15-370"><a href="#cb15-370" aria-hidden="true" tabindex="-1"></a>map_list <span class="op">=</span> gs.list_grouped(<span class="bu">type</span><span class="op">=</span><span class="st">"raster"</span>, pattern<span class="op">=</span><span class="st">"mosq_med_duration_generations_*"</span>)</span>
<span id="cb15-371"><a href="#cb15-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-372"><a href="#cb15-372" aria-hidden="true" tabindex="-1"></a><span class="co"># Animation with SeriesMap class</span></span>
<span id="cb15-373"><a href="#cb15-373" aria-hidden="true" tabindex="-1"></a>series <span class="op">=</span> gj.SeriesMap(height <span class="op">=</span> <span class="dv">500</span>)</span>
<span id="cb15-374"><a href="#cb15-374" aria-hidden="true" tabindex="-1"></a>series.add_rasters(map_list)</span>
<span id="cb15-375"><a href="#cb15-375" aria-hidden="true" tabindex="-1"></a>series.d_barscale()</span>
<span id="cb15-376"><a href="#cb15-376" aria-hidden="true" tabindex="-1"></a>series.show()</span>
<span id="cb15-377"><a href="#cb15-377" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-378"><a href="#cb15-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-379"><a href="#cb15-379" aria-hidden="true" tabindex="-1"></a>We can now remove all intermediate series and maps:</span>
<span id="cb15-380"><a href="#cb15-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-383"><a href="#cb15-383" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb15-384"><a href="#cb15-384" aria-hidden="true" tabindex="-1"></a>gs.run_command(<span class="st">"t.list"</span>, </span>
<span id="cb15-385"><a href="#cb15-385" aria-hidden="true" tabindex="-1"></a>                <span class="bu">type</span><span class="op">=</span><span class="st">"strds"</span>, </span>
<span id="cb15-386"><a href="#cb15-386" aria-hidden="true" tabindex="-1"></a>                where<span class="op">=</span><span class="st">"name LIKE '</span><span class="sc">%g</span><span class="st">en%'"</span>, </span>
<span id="cb15-387"><a href="#cb15-387" aria-hidden="true" tabindex="-1"></a>                output<span class="op">=</span><span class="st">"to_remove.txt"</span>)</span>
<span id="cb15-388"><a href="#cb15-388" aria-hidden="true" tabindex="-1"></a>gs.run_command(<span class="st">"t.remove"</span>, </span>
<span id="cb15-389"><a href="#cb15-389" aria-hidden="true" tabindex="-1"></a>                flags<span class="op">=</span><span class="st">"df"</span>, </span>
<span id="cb15-390"><a href="#cb15-390" aria-hidden="true" tabindex="-1"></a>                <span class="bu">file</span><span class="op">=</span><span class="st">"to_remove.txt"</span>)</span>
<span id="cb15-391"><a href="#cb15-391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-392"><a href="#cb15-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-393"><a href="#cb15-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-394"><a href="#cb15-394" aria-hidden="true" tabindex="-1"></a><span class="fu">## References</span></span>
<span id="cb15-395"><a href="#cb15-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-396"><a href="#cb15-396" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Neteler, M., Metz, M., Rocchini, D., Rizzoli, A., Flacio, E., et al. 2013. </span>
<span id="cb15-397"><a href="#cb15-397" aria-hidden="true" tabindex="-1"></a>_Is Switzerland Suitable for the Invasion ofAedes albopictus?_ PLOS ONE 8(12).</span>
<span id="cb15-398"><a href="#cb15-398" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">DOI</span><span class="co">](https://doi.org/10.1371/journal.pone.0082090)</span>.</span>
<span id="cb15-399"><a href="#cb15-399" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Kobayashi, M., Nihei, N., Kurihara, T. 2002. </span>
<span id="cb15-400"><a href="#cb15-400" aria-hidden="true" tabindex="-1"></a>_Analysis of Northern Distribution of *Aedes albopictus* (Diptera: Culicidae) in Japan by Geographical Information System._ </span>
<span id="cb15-401"><a href="#cb15-401" aria-hidden="true" tabindex="-1"></a>Journal of Medical Entomology 39(1), 4–11. <span class="co">[</span><span class="ot">DOI</span><span class="co">](https://doi.org/10.1603/0022-2585-39.1.4)</span>.</span>
<span id="cb15-402"><a href="#cb15-402" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Gebbert, S., Pebesma, E. 2014.</span>
<span id="cb15-403"><a href="#cb15-403" aria-hidden="true" tabindex="-1"></a>_TGRASS: A temporal GIS for field based environmental modeling._</span>
<span id="cb15-404"><a href="#cb15-404" aria-hidden="true" tabindex="-1"></a>Environmental Modelling &amp; Software 53, 1-12. </span>
<span id="cb15-405"><a href="#cb15-405" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">DOI</span><span class="co">](http://dx.doi.org/10.1016/j.envsoft.2013.11.001)</span>.</span>
<span id="cb15-406"><a href="#cb15-406" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Gebbert, S., Pebesma, E. 2017. _The GRASS GIS temporal framework._</span>
<span id="cb15-407"><a href="#cb15-407" aria-hidden="true" tabindex="-1"></a>International Journal of Geographical Information Science 31, 1273-1292. </span>
<span id="cb15-408"><a href="#cb15-408" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">DOI</span><span class="co">](http://dx.doi.org/10.1080/13658816.2017.1306862)</span>.</span>
<span id="cb15-409"><a href="#cb15-409" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Temporal data processing</span><span class="co">](https://grasswiki.osgeo.org/wiki/Temporal_data_processing)</span> wiki page.</span>
<span id="cb15-410"><a href="#cb15-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-411"><a href="#cb15-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-412"><a href="#cb15-412" aria-hidden="true" tabindex="-1"></a>***</span>
<span id="cb15-413"><a href="#cb15-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-414"><a href="#cb15-414" aria-hidden="true" tabindex="-1"></a>:::{.smaller}</span>
<span id="cb15-415"><a href="#cb15-415" aria-hidden="true" tabindex="-1"></a>The development of this tutorial was funded by the US </span>
<span id="cb15-416"><a href="#cb15-416" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">National Science Foundation (NSF)</span><span class="co">](https://www.nsf.gov/)</span>, </span>
<span id="cb15-417"><a href="#cb15-417" aria-hidden="true" tabindex="-1"></a>award <span class="co">[</span><span class="ot">2303651</span><span class="co">](https://www.nsf.gov/awardsearch/showAward?AWD_ID=2303651)</span>.</span>
<span id="cb15-418"><a href="#cb15-418" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>